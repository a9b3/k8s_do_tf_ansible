#cloud-config
# vim: set ft=yaml:

write-files:
  - path: /etc/flannel/options.env
    content: |
      FLANNELD_IFACE=$public_ipv4
      FLANNELD_ETCD_ENDPOINTS=${etcd_ips}

coreos:
  flannel:
    interface: $public_ipv4
  units:
    - name: flanneld.service
      drop-ins:
      - name: 40-ExecStartPre-symlink.conf
        content: |
          [Service]
          ExecStartPre=/usr/bin/ln -sf /etc/flannel/options.env /run/flannel/options.env
      command: start
